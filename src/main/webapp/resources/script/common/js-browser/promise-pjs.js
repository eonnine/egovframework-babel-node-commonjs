/*! Copyright (c) 2016 Justin Ridgewell - MIT Style License */
function Promise(a){if(!(this instanceof Promise))throw new TypeError("Constructor Promise requires `new`");if(!isFunction(a))throw new TypeError("Must pass resolver function");this._state=PendingPromise;this._value=[];this._isChainEnd=!0;doResolve(this,adopter(this,FulfilledPromise),adopter(this,RejectedPromise),{then:a})}Promise.prototype.then=function(a,b){a=isFunction(a)?a:void 0;b=isFunction(b)?b:void 0;if(a||b)this._isChainEnd=!1;return this._state(this._value,a,b)};
Promise.prototype["catch"]=function(a){return this.then(void 0,a)};Promise.resolve=function(a){return isObject(a)&&a instanceof this?a:new this(function(b){b(a)})};Promise.reject=function(a){return new this(function(b,d){d(a)})};Promise.all=function(a){var b=this;return new b(function(d,c){var f=a.length,e=Array(f);if(0===f)return d(e);each(a,function(a,g){b.resolve(a).then(function(a){e[g]=a;0===--f&&d(e)},c)})})};
Promise.race=function(a){var b=this;return new b(function(d,c){for(var f=0,e=a.length;f<e;f++)b.resolve(a[f]).then(d,c)})};Promise._overrideUnhandledExceptionHandler=function(a){onPossiblyUnhandledRejection=a};function FulfilledPromise(a,b,d,c){if(!b)return this;c||(c=new Deferred(this.constructor));defer(tryCatchDeferred(c,b,a));return c.promise}function RejectedPromise(a,b,d,c){if(!d)return this;c||(c=new Deferred(this.constructor));defer(tryCatchDeferred(c,d,a));return c.promise}
function PendingPromise(a,b,d,c){if(!b&&!d)return this;c||(c=new Deferred(this.constructor));a.push({deferred:c,onFulfilled:b||c.resolve,onRejected:d||c.reject});return c.promise}function Deferred(a){var b=this;this.promise=new a(function(a,c){b.resolve=a;b.reject=c});return b}
function adopt(a,b,d){var c=a._value;a._state=b;a._value=d;for(var f=0;f<c.length;f++){var e=c[f];a._state(d,e.onFulfilled,e.onRejected,e.deferred)}b===RejectedPromise&&a._isChainEnd&&setTimeout(function(){a._isChainEnd&&onPossiblyUnhandledRejection(d,a)},0)}function adopter(a,b){return function(d){adopt(a,b,d)}}function noop(){}function isFunction(a){return"function"===typeof a}function isObject(a){return a===Object(a)}var onPossiblyUnhandledRejection=function(a,b){throw a;};
function each(a,b){for(var d=0;d<a.length;d++)b(a[d],d)}function tryCatchDeferred(a,b,d){var c=a.promise,f=a.resolve,e=a.reject;return function(){try{var a=b(d);f!==b&&e!==b&&doResolve(c,f,e,a,a)}catch(g){e(g)}}}
var defer=function(){function a(){for(var a=0;a<c;a++){var b=d[a];d[a]=null;b()}c=0}var b;"undefined"!==typeof window&&window.postMessage?(window.addEventListener("message",a),b=function(){window.postMessage("macro-task","*")}):b=function(){setTimeout(a,0)};var d=Array(16),c=0;return function(a){0===c&&b();d[c++]=a}}();
function doResolve(a,b,d,c,f){var e=d,h,g;try{if(c===a)throw new TypeError("Cannot fulfill promise with itself");var k=isObject(c);k&&c instanceof a.constructor?adopt(a,c._state,c._value):k&&(h=c.then)&&isFunction(h)?(g=function(c){g=e=noop;doResolve(a,b,d,c,c)},e=function(a){g=e=noop;d(a)},h.call(f,function(a){g(a)},function(a){e(a)})):b(c)}catch(l){e(l)}}